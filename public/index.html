<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Imidio Mining Platform</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
  h1, h2 { color: #333; }
  .plan { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; background: #fff; }
  button { margin-top: 5px; padding: 6px 12px; cursor: pointer; }
</style>
</head>
<body>

<h1>Bem-vindo, <span id="userName">Usuário</span>!</h1>
<p>Saldo: <span id="balance">0</span> Coins</p>

<h2>Planos Disponíveis</h2>
<div id="plans"></div>

<script>
const userId = "ID_DO_SEU_USUARIO"; // Coloque o ID do usuário real
const userNameSpan = document.getElementById("userName");
const balanceSpan = document.getElementById("balance");

// Carregar usuário
fetch(`/api/users/${userId}`)
  .then(res => res.json())
  .then(user => {
    userNameSpan.innerText = user.name;
    balanceSpan.innerText = user.balance;
  });

// Carregar planos
fetch("/api/plans")
  .then(res => res.json())
  .then(plans => {
    const plansDiv = document.getElementById("plans");
    plans.forEach(plan => {
      const div = document.createElement("div");
      div.className = "plan";
      div.innerHTML = `
        <strong>${plan.name}</strong><br>
        Preço: $${plan.price}<br>
        Lucro: ${plan.profitPercent}% em ${plan.durationDays} dias (Saque: ${plan.withdrawDelayDays} dias)<br>
        <button onclick="buyPlan('${plan._id}')">Comprar</button>
      `;
      plansDiv.appendChild(div);
    });
  });

function buyPlan(planId) {
  fetch("/api/buy-plan", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ userId, planId })
  })
  .then(res => res.json())
  .then(data => {
    if (data.error) {
      alert(data.error);
    } else {
      alert(data.message);
      balanceSpan.innerText = parseFloat(balanceSpan.innerText) - data.stake.price;
    }
  });
}
</script>

</body>
</html>
